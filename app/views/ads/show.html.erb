<h1><%= @ad.title %></h1>

<h3><%= @ad.company %></h3>

<div id="description">
  <%= sanitize(@ad.description) %>
</div>

<div id="contact">Contact: <%= @ad.user.name %></div>

<% if owned_by_current_user?(@ad) %>
  <%= link_to 'Edit', edit_ad_path(@ad) %> |
<% end %>
<%= link_to 'List', ads_path %>

<% unless owned_by_current_user?(@ad) %>
<div id="reply">
<%= form_for([@ad, @ad.replies.new]) do |f| %>
  <div class="field">
    <%= f.label :body, 'Reply' %><br />
    <%= f.text_area :body %>
  </div>
  <div class="actions">
    <%= f.submit 'Submit' %>
  </div>
<% end %>
</div>
<% end %>

<% if owned_by_current_user?(@ad) and !@ad.replies.empty? %>
  <h2>Replies</h2>
  <% @ad.replies.each do |reply| %>
    <%if reply && reply.user %>
    <div class="reply_contact">
      <%= mail_to reply.user.email, reply.user.name %>
      <%= link_to 'Destroy', [@ad, reply], confirm: 'Are you sure?', method: :delete %>
    </div>
    <div class="reply_body">
      <%= sanitize(reply.body) %>
    </div>
    <% end %>
  <% end %>
<% end %>
